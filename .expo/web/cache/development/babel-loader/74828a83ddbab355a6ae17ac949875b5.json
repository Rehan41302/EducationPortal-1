{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/denoversshehroz/Documents/React Native/Rehan/EducationPortal/components/tutordashboard/QuizUpload.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from \"react\";\nimport firebase from \"../../config/fire\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport TextInput from \"react-native-web/dist/exports/TextInput\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport { Web } from \"react-native-web/dist/index\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Linking from \"react-native-web/dist/exports/Linking\";\nimport * as DocumentPicker from \"expo-document-picker\";\nimport * as RNP from \"react-native-paper\";\nimport { connect } from \"react-redux\";\nimport PDFReader from \"rn-pdf-reader-js\";\nimport { firestore } from \"firebase\";\nimport * as FileSystem from \"expo-file-system\";\nimport { WebView } from \"react-native-webview\";\n\nvar PDFVIEW = function PDFVIEW() {\n  var webView = undefined;\n  return React.createElement(WebView, {\n    style: styles.webview,\n    source: {\n      uri: \"https://firebasestorage.googleapis.com/v0/b/educationporal.appspot.com/o/quiz%2F1604218587548-intro-lec01-converted.pdf?alt=media&token=5a1058b1-b0b2-42d9-9d05-0ce991053572\"\n    },\n    ref: function ref(_ref) {\n      webView = _ref;\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 31,\n      columnNumber: 5\n    }\n  });\n};\n\nvar QuizUpload = function (_React$Component) {\n  _inherits(QuizUpload, _React$Component);\n\n  var _super = _createSuper(QuizUpload);\n\n  function QuizUpload() {\n    var _this2;\n\n    _classCallCheck(this, QuizUpload);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this2 = _super.call.apply(_super, [this].concat(args));\n    _this2.state = {\n      fullPath: \"\",\n      downloadURL: \"\",\n      progress: 0,\n      uploading: false\n    };\n\n    _this2.pickDocumentPDF = function _callee() {\n      var res, that, getTime, storageRef, ref, fullPath, uploadTask;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(DocumentPicker.getDocumentAsync({\n                type: \"application/pdf\"\n              }));\n\n            case 3:\n              res = _context.sent;\n              console.log(\"res : \" + JSON.stringify(res));\n              console.log(\"Type : \" + res.type);\n\n              if (res.type === \"success\") {\n                _this2.setState({\n                  uploading: true\n                });\n\n                that = _assertThisInitialized(_this2);\n                getTime = new Date().getTime();\n                storageRef = firebase.storage().ref();\n                ref = storageRef.child(\"/quiz/\" + getTime + \"-\" + res.name);\n                fullPath = ref.fullPath;\n                uploadTask = ref.putString(res.uri, \"data_url\");\n                uploadTask.on(\"state_changed\", function (snapshot) {\n                  var progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n                  console.log(\"Upload is \" + progress + \"% done\");\n                  that.setState({\n                    progress: Math.round(progress)\n                  });\n                }, function (error) {\n                  console.error(error.message);\n                  Alert.alert(error.message);\n                }, function () {\n                  var _that$props, _that$props$user;\n\n                  var prevQuiz = ((_that$props = that.props) == null ? void 0 : (_that$props$user = _that$props.user) == null ? void 0 : _that$props$user.quiz) || [];\n                  uploadTask.snapshot.ref.getDownloadURL().then(function (downloadURL) {\n                    var _that$props$user2;\n\n                    prevQuiz.push({\n                      uploadTime: firestore.Timestamp.now(),\n                      pdfLink: downloadURL,\n                      storageAddress: fullPath\n                    });\n                    var db = firebase.firestore();\n                    db.collection(\"tutors\").doc((_that$props$user2 = that.props.user) == null ? void 0 : _that$props$user2.id).set(_objectSpread(_objectSpread({}, that.props.user), {}, {\n                      quiz: prevQuiz\n                    })).then(function () {\n                      that.setState({\n                        uploading: false,\n                        downloadURL: downloadURL,\n                        fullPath: fullPath\n                      });\n                    }).catch(function (error) {\n                      console.error(error);\n                      Alert.alert(error.message);\n                    });\n                  }).catch(function (error) {\n                    console.error(error);\n                    Alert.alert(error.message);\n                  });\n                });\n              }\n\n              _context.next = 13;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](0);\n              alert(\"Unknown Error: \" + JSON.stringify(_context.t0));\n              throw _context.t0;\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[0, 9]], Promise);\n    };\n\n    _this2.renderItem = function (_ref2) {\n      var item = _ref2.item,\n          index = _ref2.index;\n      var createDate = new Date(item.uploadTime.seconds * 1000);\n      return React.createElement(RNP.Card, {\n        style: styles.card,\n        __self: _assertThisInitialized(_this2),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 7\n        }\n      }, React.createElement(RNP.Card.Content, {\n        __self: _assertThisInitialized(_this2),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 9\n        }\n      }, React.createElement(RNP.Title, {\n        __self: _assertThisInitialized(_this2),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 11\n        }\n      }, \"Quiz \", index + 1, \" \"), React.createElement(RNP.Paragraph, {\n        __self: _assertThisInitialized(_this2),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 11\n        }\n      }, \"Uploaded: \", createDate.toLocaleTimeString(), \",\", \" \", createDate.toDateString(), \" \")), React.createElement(RNP.Card.Actions, {\n        __self: _assertThisInitialized(_this2),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 9\n        }\n      }, React.createElement(RNP.Button, {\n        onPress: function onPress() {\n          return _this2.downloadPDF(item.pdfLink);\n        },\n        __self: _assertThisInitialized(_this2),\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 11\n        }\n      }, \"DOWNLOAD\")));\n    };\n\n    _this2.downloadPDF = function (link) {\n      Linking.openURL(\"https://firebasestorage.googleapis.com/v0/b/educationporal.appspot.com/o/quiz%2F1604218587548-intro-lec01-converted.pdf?alt=media&token=5a1058b1-b0b2-42d9-9d05-0ce991053572\");\n    };\n\n    return _this2;\n  }\n\n  _createClass(QuizUpload, [{\n    key: \"render\",\n    value: function render() {\n      var user = this.props.user;\n      console.log({\n        user: user\n      });\n      return React.createElement(View, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190,\n          columnNumber: 7\n        }\n      }, React.createElement(View, {\n        style: {\n          marginVertical: 10,\n          marginHorizontal: 10\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 9\n        }\n      }, React.createElement(Button, {\n        title: this.state.uploading ? \"Uploading \" + this.state.progress + \"%\" : \"Upload New\",\n        onPress: this.pickDocumentPDF,\n        style: styles.uploadBtn,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 11\n        }\n      })), (user == null ? void 0 : user.quiz) && React.createElement(FlatList, {\n        data: user.quiz,\n        renderItem: this.renderItem,\n        keyExtractor: function keyExtractor(item) {\n          return item.pdfLink;\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 11\n        }\n      }));\n    }\n  }]);\n\n  return QuizUpload;\n}(React.Component);\n\nvar mapStatetoProps = function mapStatetoProps(state) {\n  console.log({\n    state: state\n  });\n  return {\n    user: state.authReducer.user,\n    isAuthenticated: state.authReducer.isAuthenticated\n  };\n};\n\nexport default connect(mapStatetoProps)(QuizUpload);\nvar styles = StyleSheet.create({\n  card: {\n    marginVertical: 10\n  },\n  webview: {\n    backgroundColor: \"yellow\",\n    height: 320,\n    width: 200\n  },\n  uploadBtn: {\n    marginTop: 10,\n    flex: 1,\n    paddingVertical: 10,\n    backgroundColor: \"#4fc3f7\",\n    alignContent: \"center\"\n  },\n  btnText: {\n    color: \"#ffffff\",\n    textAlign: \"center\"\n  }\n});","map":{"version":3,"sources":["/Users/denoversshehroz/Documents/React Native/Rehan/EducationPortal/components/tutordashboard/QuizUpload.js"],"names":["React","firebase","Web","DocumentPicker","RNP","connect","PDFReader","firestore","FileSystem","WebView","PDFVIEW","webView","undefined","styles","webview","uri","ref","QuizUpload","state","fullPath","downloadURL","progress","uploading","pickDocumentPDF","getDocumentAsync","type","res","console","log","JSON","stringify","setState","that","getTime","Date","storageRef","storage","child","name","uploadTask","putString","on","snapshot","bytesTransferred","totalBytes","Math","round","error","message","Alert","alert","prevQuiz","props","user","quiz","getDownloadURL","then","push","uploadTime","Timestamp","now","pdfLink","storageAddress","db","collection","doc","id","set","catch","renderItem","item","index","createDate","seconds","card","toLocaleTimeString","toDateString","downloadPDF","link","Linking","openURL","marginVertical","marginHorizontal","uploadBtn","Component","mapStatetoProps","authReducer","isAuthenticated","StyleSheet","create","backgroundColor","height","width","marginTop","flex","paddingVertical","alignContent","btnText","color","textAlign"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport firebase from \"../../config/fire\";\nimport {\n  Text,\n  View,\n  StyleSheet,\n  Image,\n  ScrollView,\n  TextInput,\n  TouchableOpacity,\n  ImageBackground,\n  Alert,\n  FlatList,\n  Web,\n  SafeAreaView,\n  Button,\n  Linking\n} from \"react-native\";\nimport * as DocumentPicker from \"expo-document-picker\";\nimport // { Avatar, Button, Card, Title, Paragraph }\n* as RNP from \"react-native-paper\";\nimport { connect } from \"react-redux\";\nimport PDFReader from \"rn-pdf-reader-js\";\nimport { firestore } from \"firebase\";\nimport * as FileSystem from \"expo-file-system\";\nimport { WebView } from \"react-native-webview\";\n\nconst PDFVIEW = () => {\n  let webView = undefined;\n  return (\n    <WebView\n      style={styles.webview}\n      source={{\n        uri:\n          \"https://firebasestorage.googleapis.com/v0/b/educationporal.appspot.com/o/quiz%2F1604218587548-intro-lec01-converted.pdf?alt=media&token=5a1058b1-b0b2-42d9-9d05-0ce991053572\"\n      }}\n      ref={ref => {\n        webView = ref;\n      }}\n      // onError={() => {\n      //   webView.reload();\n      // }}\n    />\n  );\n};\n\nclass QuizUpload extends React.Component {\n  state = {\n    fullPath: \"\",\n    downloadURL: \"\",\n    progress: 0,\n    uploading: false\n  };\n\n  pickDocumentPDF = async () => {\n    try {\n      const res = await DocumentPicker.getDocumentAsync({\n        type: \"application/pdf\"\n      });\n      //Printing the log realted to the file\n      console.log(\"res : \" + JSON.stringify(res));\n      console.log(\"Type : \" + res.type);\n      if (res.type === \"success\") {\n        this.setState({ uploading: true });\n        let that = this;\n        let getTime = new Date().getTime();\n        let storageRef = firebase.storage().ref();\n        let ref = storageRef.child(`/quiz/${getTime}-${res.name}`);\n        let fullPath = ref.fullPath;\n        let uploadTask = ref.putString(res.uri, \"data_url\");\n        // New Addintion\n        uploadTask.on(\n          \"state_changed\",\n          function(snapshot) {\n            // Observe state change events such as progress, pause, and resume\n            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\n            var progress =\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\n            console.log(\"Upload is \" + progress + \"% done\");\n            that.setState({\n              progress: Math.round(progress)\n            });\n          },\n          function(error) {\n            // Handle unsuccessful uploads\n            console.error(error.message);\n            Alert.alert(error.message);\n          },\n          function() {\n            // Handle successful uploads on complete\n            let prevQuiz = that.props?.user?.quiz || [];\n            uploadTask.snapshot.ref\n              .getDownloadURL()\n              .then(function(downloadURL) {\n                prevQuiz.push({\n                  uploadTime: firestore.Timestamp.now(),\n                  pdfLink: downloadURL,\n                  storageAddress: fullPath\n                });\n                const db = firebase.firestore();\n                db.collection(\"tutors\")\n                  .doc(that.props.user?.id)\n                  .set({\n                    ...that.props.user,\n                    quiz: prevQuiz\n                  })\n                  .then(() => {\n                    that.setState({\n                      uploading: false,\n                      downloadURL,\n                      fullPath\n                    });\n                  })\n                  .catch(error => {\n                    console.error(error);\n                    Alert.alert(error.message);\n                  });\n              })\n              .catch(error => {\n                console.error(error);\n                Alert.alert(error.message);\n              });\n          }\n        );\n      }\n    } catch (err) {\n      alert(\"Unknown Error: \" + JSON.stringify(err));\n      throw err;\n    }\n  };\n\n  renderItem = ({ item, index }) => {\n    let createDate = new Date(item.uploadTime.seconds * 1000);\n\n    return (\n      <RNP.Card style={styles.card}>\n        <RNP.Card.Content>\n          <RNP.Title>Quiz {index + 1} </RNP.Title>\n          <RNP.Paragraph>\n            Uploaded: {createDate.toLocaleTimeString()},{\" \"}\n            {createDate.toDateString()}{\" \"}\n          </RNP.Paragraph>\n          {/* <Paragraph>Time & Date</Paragraph> */}\n        </RNP.Card.Content>\n        {/* <Card.Cover source={{ uri: \"https://picsum.photos/700\" }} /> */}\n        <RNP.Card.Actions>\n          <RNP.Button onPress={() => this.downloadPDF(item.pdfLink)}>\n            DOWNLOAD\n          </RNP.Button>\n        </RNP.Card.Actions>\n      </RNP.Card>\n    );\n  };\n\n  downloadPDF = link => {\n    Linking.openURL(\n      \"https://firebasestorage.googleapis.com/v0/b/educationporal.appspot.com/o/quiz%2F1604218587548-intro-lec01-converted.pdf?alt=media&token=5a1058b1-b0b2-42d9-9d05-0ce991053572\"\n    );\n    // FileSystem.downloadAsync(\n    //   \"https://firebasestorage.googleapis.com/v0/b/educationporal.appspot.com/o/quiz%2F1604218587548-intro-lec01-converted.pdf?alt=media&token=5a1058b1-b0b2-42d9-9d05-0ce991053572\",\n    //   FileSystem.documentDirectory + \"tutor.pdf\"\n    // )\n    //   .then(({ uri }) => {\n    //     console.log(\"Finished downloading to \", uri);\n    //   })\n    //   .catch(error => {\n    //     console.error(error);\n    //     // Alert.alert(error);\n    //   });\n  };\n\n  render() {\n    let { user } = this.props;\n    console.log({ user });\n    // if (user) {\n    //   return (\n    //     <PDFReader\n    //       source={{\n    //         uri:\n    //           \"https://firebasestorage.googleapis.com/v0/b/educationporal.appspot.com/o/quiz%2F1604218587548-intro-lec01-converted.pdf?alt=media&token=5a1058b1-b0b2-42d9-9d05-0ce991053572\"\n    //       }}\n    //       webviewProps={{\n    //         startInLoadingState: true\n    //       }}\n    //       style={styles.webview}\n    //     />\n    //   );\n    // }\n    return (\n      <View>\n        <View style={{ marginVertical: 10, marginHorizontal: 10 }}>\n          <Button\n            title={\n              this.state.uploading\n                ? `Uploading ${this.state.progress}%`\n                : \"Upload New\"\n            }\n            onPress={this.pickDocumentPDF}\n            style={styles.uploadBtn}\n          />\n        </View>\n        {/* <TouchableOpacity\n          style={styles.uploadBtn}\n          onPress={this.pickDocumentPDF}\n        >\n          <Text style={styles.btnText}>\n            {this.state.uploading\n              ? `Uploading ${this.state.progress}%`\n              : \"Upload New\"}\n          </Text>\n        </TouchableOpacity> */}\n        {user?.quiz && (\n          // <SafeAreaView>\n          <FlatList\n            data={user.quiz}\n            renderItem={this.renderItem}\n            keyExtractor={item => item.pdfLink}\n          />\n          // {/* </SafeAreaView> */}\n        )}\n      </View>\n    );\n  }\n}\n\nconst mapStatetoProps = state => {\n  console.log({ state });\n  return {\n    user: state.authReducer.user,\n    isAuthenticated: state.authReducer.isAuthenticated\n  };\n};\nexport default connect(mapStatetoProps)(QuizUpload);\n\nconst styles = StyleSheet.create({\n  card: {\n    marginVertical: 10\n  },\n  webview: {\n    backgroundColor: \"yellow\",\n    height: 320,\n    width: 200\n  },\n  uploadBtn: {\n    marginTop: 10,\n    flex: 1,\n    paddingVertical: 10,\n    backgroundColor: \"#4fc3f7\",\n    alignContent: \"center\"\n  },\n  btnText: {\n    color: \"#ffffff\",\n    textAlign: \"center\"\n    // fontWeight: 500\n  }\n});\n"]},"metadata":{},"sourceType":"module"}